library(psych)
library(dplyr)

X <- matrix(c(-0.47,-0.13,-0.1,1.31,0.92,-0.7,0.18,-0.49,0.06,-0.19,0.01,-0.33,-0.99,-0.38,1.4,0.34,-0.88,-0.65,-0.06,0.24,0.47,1.34,1.61,-2.46,-0.07,0.77,0.15,-1.08,-0.32,-2.37,1.52,0.89,-1.07,0.26,-3.08,0,1.1,0.26,1.64,1.02,1.19,-1.12,0.21,3.33,0.16,-0.3,0.25,0.58,0.4,-0.25,1.73,0.15,-0.52,0.61,-0.25,0.15,0.05,-0.43,-0.49,1.58,0.11,-1.26,-0.37,-0.25,-0.12,-0.6,0.38,-0.27,-0.65,0.16,-0.39,-0.77,0.76,-0.01,1.73,1.02,1.54,-0.68,0.03,2.12,-0.12,-1.67,0.35,-2.27,0.37,0.44,-0.52,-0.2,-3.4,-0.08,-0.51,-0.53,-0.61,0.91,1.4,-1.59,-0.21,-1.51,0.18,-1.46,-0.58,-2,1.44,1.47,1.12,-0.01,-1.83,-0.23,-0.03,0.14,-0.19,0.42,-1.4,-1.01,-0.04,0.29,-0.66,-0.17,-0.12,-1.04,2.96,2.11,-4.07,0.13,0.19,-0.41,-0.02,-0.06,-1.12,-0.66,-0.56,-0.52,0,-1.11,0.6,0.89,0.18,1.28,1.19,1.36,-0.98,0.36,2.21,0.04,0.29,-0.46,0.32,0.6,0.05,-0.13,0.03,0.58,-0.66,0.63,-0.25,0.35,-3.23,-2.03,0.82,0.16,1.75,-0.45,0.38,-0.28,0.52,-1.04,-1.55,1.3,-0.05,1.59,0.2,0.58,-0.24,0.58,0.97,-0.32,1.11,-0.02,1.97,-0.03,-0.38,0.18,-0.62,0.18,0.12,-0.45,0.03,-0.52,-0.16,0.86,0.14,0.66,1.12,1.25,1.38,0.24,1.71,-0.79,-0.5,-0.07,-0.81,2.31,1.93,-1.81,0,-1.55,-0.24,-0.98,0.02,-0.28,1.13,0.64,-0.12,-0.19,-1.24,0.21,0.49,-0.45,1.88,2.41,2.17,-0.62,-0.14,1.36,0.37,-0.51,-0.06,-0.77,-0.35,-1.6,2.28,0,-2.75,-0.68,0.32,0.45,0.72,0.92,1.03,0.36,-0.45,1.88,0.34,0.07,0.16,-0.2,-0.87,-0.73,2.02,-0.01,0.04,-0.06,1.19,0.25,1.04,1.83,-0.79,0.7,0.36,2.73,0.2,-0.15,-0.35,0.24,0.34,0.45,0.68,-0.02,1.3,-0.12,-0.47,0.34,-0.9,2.42,2.06,-0.64,0.17,-0.36,-0.09,0.98,-0.27,1.12,-1.79,-0.3,-1.07,0.09,2.5,0,0.92,0.07,1.22,0.91,0.79,-2.21,0.02,2.21,-0.27,-0.21,0.33,-0.29,-1.16,-0.42,0.07,0.01,-0.45,-0.3,-1.12,0.06,-1.05,0.74,0.33,-0.95,-0.22,-2.49,0.01,-0.38,0.13,-0.32,0.46,-0.42,0.07,-0.46,-1.28,-0.64,-0.73,0.41,0.34,0.46,1.11,-0.33,-0.04,-0.65,0.11,-0.38,0.06,-0.74,0.83,0.06,1.04,0.01,0.02,0.14,-0.18,0.05,-1.1,-1.49,-1.51,2.38,0.06,-0.92,-0.09,0.79,-0.13,1.04,-1.42,-0.97,1.12,0.06,1.55,0.1,-1.83,-0.03,-1.55,2.4,2.86,-3.89,0.14,-4.39,0.72,0.92,0.35,1.05,-1.3,-1.7,2.7,-0.14,1.38,-0.2,-0.12,-0.5,-0.5,2.1,1.14,-2.18,0.07,-0.53,-0.12,-0.32,0.09,-0.38,0.18,-0.03,0.59,-0.12,-0.35,0.1,-0.65,-0.05,-1.66,0.9,-0.02,0.4,0.15,-2.08,0.53,0.73,0.29,1.37,-0.95,-0.58,1.23,-0.1,2.5,0.5,-0.5,-0.02,-0.2,0.29,-0.2,-0.85,-0.07,-1.1,0.4,-0.48,0.4,-0.97,-1.28,-1.44,1.32,0.32,-0.57,0.01,0.94,0.36,1.48,2.05,1.01,-0.98,-0.06,1.4,0.53,0.63,-0.35,0.3,-0.07,-0.75,0.11,-0.09,1.31,0.31,-0.16,0.5,0.02,-1.94,-1.34,0.87,-0.32,-0.32,-0.09,0,-0.2,0.15,-1.68,-0.69,1.41,0.13,-0.07,0.02,0.45,0.27,0.39,0.1,0.25,0.43,-0.13,0.7,-0.96,-1.61,0.47,-2.07,0.24,0.45,0.37,-0.18,-4.4,0.25,-0.08,-0.45,0.68,-2.72,-1.76,0.19,0.07,-0.05,0.04,-0.13,0,0.02,0.85,0.49,0.83,-0.13,1.44,-0.24), nrow=56, ncol=9, byrow=TRUE, dimnames=list(NULL,paste0("X",1:9)))
write.csv(as.data.frame(X), file="X.csv")
#############ans_a_1#####################
(ans_a_i <- factanal(X, 1))


#############ans_a_ii#####################
(ans_a_ii <- factanal(X, 2))

#############ans_a_iii#####################
(ans_a_iii <- factanal(X, 3))

#############ans_a_4#####################
(b_i <- fa(X, 2,fm='ml',rotate='varimax'))
#Factor Analysis using method =  ml
#Call: fa(r = X, nfactors = 2, rotate = "varimax", fm = "ml")
#Standardized loadings (pattern matrix) based upon correlation matrix
#     ML2   ML1     h2    u2 com
#X1  0.95 -0.22 0.9424 0.058 1.1
#X2  0.01 -0.06 0.0036 0.996 1.0
#X3  0.90 -0.07 0.8157 0.184 1.0
#X4 -0.02  0.84 0.7134 0.287 1.0
#X5 -0.01  1.00 0.9950 0.005 1.0
#X6  0.04 -0.69 0.4729 0.527 1.0
#X7  0.14  0.02 0.0209 0.979 1.0
#X8  0.96 -0.11 0.9254 0.075 1.0
#X9 -0.03  0.18 0.0318 0.968 1.1
#ML1 x4,x5,x6, ML2 x1,x3,x8

########## ans_b#####################
b_i$loadings
lambda <- matrix(c(0.946, -0.216, 0, 0, 0.901, 0, 0, 0.844, 0, 0.997, 0, -0.687, 0.144, 0, 0.956, -0.106, 0, 0.175), byrow = TRUE,ncol = 2)
#      [,1]   [,2]
#[1,] 0.946 -0.216
#[2,] 0.000  0.000
#[3,] 0.901  0.000
#[4,] 0.000  0.844
#[5,] 0.000  0.997
#[6,] 0.000 -0.687
#[7,] 0.144  0.000
#[8,] 0.956 -0.106
#[9,] 0.000  0.175

sigma_error <- ans_a_iv$uniquenesses
Sigma = lambda %*% t(lambda) + diag(sigma_error)
b_iv <- matrix(c(0.9991485, 0.0000000, 0.8523460, -0.1823040, -0.2153520,  0.148392, 0.1362240,  0.9272720, -0.0378000,
                 0.0000000, 0.9964478, 0.0000000,  0.0000000,  0.0000000,  0.000000, 0.0000000,  0.0000000,  0.0000000,
                 0.8523460, 0.0000000, 0.9961084,  0.0000000,  0.0000000,  0.000000, 0.1297440,  0.8613560,  0.0000000,
                 -0.1823040, 0.0000000, 0.0000000,  0.9989584,  0.8414680, -0.579828, 0.0000000, -0.0894640,  0.1477000,
                 -0.2153520, 0.0000000, 0.0000000,  0.8414680,  0.9990039, -0.684939, 0.0000000, -0.1056820,  0.1744750,
                 0.1483920, 0.0000000, 0.0000000, -0.5798280, -0.6849390,  0.999028, 0.0000000,  0.0728220, -0.1202250,
                 0.1362240, 0.0000000, 0.1297440,  0.0000000,  0.0000000,  0.000000, 0.9998333,  0.1376640,  0.0000000,
                 0.9272720, 0.0000000, 0.8613560, -0.0894640, -0.1056820,  0.072822, 0.1376640,  0.9997992, -0.0185500,
                 -0.0378000, 0.0000000, 0.0000000,  0.1477000,  0.1744750, -0.120225, 0.0000000, -0.0185500,  0.9988515), byrow = TRUE,ncol = 9)




